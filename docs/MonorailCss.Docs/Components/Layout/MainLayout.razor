@using MyLittleContentEngine.Services.Content.TableOfContents
@inherits LayoutComponentBase
@inject ITableOfContentService TableOfContentService
@inject NavigationManager NavigationManager

<div class="min-h-screen dark:scheme-dark bg-base-50 dark:bg-base-950">
    <header
        class="sticky top-0 h-16 z-50 w-full border-b border-base-200 dark:border-base-800 bg-white/95 dark:bg-base-900/95 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-base-900/60">
        <div class="max-w-400 mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Left side - Sidebar toggle and Logo -->
                <div class="flex items-center space-x-3">

                    <button id="sidebar-toggle"
                            class="lg:hidden p-2 rounded-md text-base-600 dark:text-base-400 hover:bg-base-100 dark:hover:bg-base-800 transition-colors"
                            aria-label="Toggle sidebar">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>

                    <!-- Logo and Title -->
                    <a href="/" class="flex items-center space-x-2">
                    <span
                        class="text-2xl font-bold bg-gradient-to-r from-primary-600 to-tertiary-one-600 dark:from-primary-400 dark:to-tertiary-one-400 bg-clip-text text-transparent">
                        MonorailCss
                    </span>
                    </a>
                </div>

                <!-- Navigation -->
                <nav class="hidden md:flex items-center space-x-1">
                    <a href="/"
                       class="px-3 py-2 rounded-md text-sm font-medium @(IsHomePage ? "bg-base-100 dark:bg-base-800 text-base-900 dark:text-base-100" : "text-base-600 dark:text-base-400 hover:text-base-900 dark:hover:text-base-100 hover:bg-base-100 dark:hover:bg-base-800") transition-colors">
                        Documentation
                    </a>
                    <a href="https://github.com/monorailcss/MonorailCss.Framework" target="_blank" rel="noopener noreferrer"
                       class="px-3 py-2 rounded-md text-sm font-medium text-base-600 dark:text-base-400 hover:text-base-900 dark:hover:text-base-100 hover:bg-base-100 dark:hover:bg-base-800 transition-colors">
                        GitHub
                    </a>
                </nav>

                <!-- Right side actions -->
                <div class="flex items-center space-x-2">
                    <div
                        class="relative w-8 md:w-32 lg:w-64 bg-base-100 dark:bg-base-800/50 border border-base-200 dark:border-base-700 rounded-full lg:rounded-md ">
                        <input
                            id="search-input"
                            type="text"
                            class="transition-all text-xs lg:text-sm w-full h-8 lg:h-10 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500/50 dark:focus:ring-primary-400/50 focus:border-transparent"
                            readonly
                        />
                        <svg
                            class="transition-all absolute left-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-base-500 dark:text-base-400 pointer-events-none"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                        </svg>
                        <div
                            class="transition-all text-xs md:text-sm hidden md:block absolute left-10 top-1/2 transform -translate-y-1/2 text-base-600 dark:text-base-400  pointer-events-none">
                            Search
                        </div>
                    </div>

                    <!-- Dark mode toggle button -->
                    <button data-theme-toggle
                            class="p-2 rounded-md text-base-600 dark:text-base-400 hover:bg-base-100 dark:hover:bg-base-800 transition-colors"
                            aria-label="Toggle theme">
                        <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>

                    <!-- Mobile menu button -->
                    <button id="mobile-menu-button"
                            class="md:hidden p-2 rounded-md text-base-600 dark:text-base-400 hover:bg-base-100 dark:hover:bg-base-800 transition-colors"
                            aria-label="Toggle menu">
                        <svg viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4">
                            <path
                                d="M8 2a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM8 6.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM9.5 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation -->
        <nav id="mobile-menu" data-expanded="false"
             class="md:hidden data-[expanded=false]:hidden bg-base-50 dark:bg-base-950 border-b border-base-200 dark:border-base-800 shadow-md">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="/"
                   class="block px-3 py-2 rounded-md text-base font-medium @(IsHomePage ? "bg-base-100 dark:bg-base-800 text-base-900 dark:text-base-100" : "text-base-600 dark:text-base-400 hover:text-base-900 dark:hover:text-base-100 hover:bg-base-100 dark:hover:bg-base-800") transition-colors">
                    Documentation
                </a>
                <a href="https://github.com/monorailcss/MonorailCss.Framework" target="_blank" rel="noopener noreferrer"
                   class="block px-3 py-2 rounded-md text-base font-medium text-base-600 dark:text-base-400 hover:text-base-900 dark:hover:text-base-100 hover:bg-base-100 dark:hover:bg-base-800 transition-colors">
                    GitHub
                </a>
            </div>
        </nav>
    </header>
    <!-- Main Content Area -->
    <div class="max-w-400 mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Sidebar -->
            <aside class="hidden lg:block lg:w-64 xl:w-72 shrink-0 sticky top-16 self-start">
                <div class="overflow-y-auto max-h-[calc(100vh-4rem)] pr-4 -mr-4">
                    <div class="py-8">
                        <TableOfContentsNavigation TableOfContents="_toc"/>
                    </div>
                </div>
            </aside>

            <!-- Mobile Sidebar Overlay -->
            <div id="sidebar-overlay"
                 class="lg:hidden fixed inset-0 z-40 hidden bg-base-50/50 dark:bg-base-900/50 backdrop-blur">
                <div id="sidebar-panel"
                     class="fixed inset-y-0 top-16 left-0 w-80 bg-base-50 dark:bg-base-900 shadow-xl overflow-y-auto">
                    <div class="p-4">
                        <button id="sidebar-close"
                                class="mb-4 p-2 rounded-md hover:bg-base-100 dark:hover:bg-base-800 transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                        <TableOfContentsNavigation TableOfContents="_toc"/>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <main class="flex-1 min-w-0 py-8">
                <div class="bg-white dark:bg-base-900 rounded-lg shadow-sm border border-base-200 dark:border-base-800">
                    <div class="p-6 lg:p-8">
                        @Body
                    </div>
                </div>

                <footer class="mt-16">
                    <div
                        class="container mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm text-base-500 dark:text-base-400">
                        <p>&copy; @DateTime.Now.Year MonorailCss - A Tailwind CSS 4.1 compatible CSS engine written in
                            .NET</p>
                    </div>
                </footer>
            </main>
        </div>
    </div>
</div>


@code{
    private ImmutableList<NavigationTreeItem>? _toc;
    private bool IsHomePage => NavigationManager.Uri.TrimEnd('/').EndsWith(NavigationManager.BaseUri.TrimEnd('/'));

    protected override async Task OnInitializedAsync()
    {
        var currentPath = NavigationManager.ToAbsoluteUri(NavigationManager.Uri).AbsolutePath;


        // Get the table of contents for the current section
        _toc = (await TableOfContentService.GetNavigationTocAsync(currentPath)).ToImmutableList();


        await base.OnInitializedAsync();
    }

}