<Project>
  <!-- MonorailCss Build Task Definition -->
  <UsingTask TaskName="MonorailCss.Build.Tasks.ProcessCssTask"
             AssemblyFile="$(MSBuildThisFileDirectory)..\bin\$(Configuration)\net9.0\MonorailCss.Build.Tasks.dll"
             Condition="'$(MonorailCssDevelopment)' == 'true'" />
  <UsingTask TaskName="MonorailCss.Build.Tasks.ProcessCssTask"
             AssemblyFile="$(MSBuildThisFileDirectory)..\tasks\net9.0\MonorailCss.Build.Tasks.dll"
             Condition="'$(MonorailCssDevelopment)' != 'true'" />

  <!-- Define the custom build action for MonorailCss files -->
  <ItemGroup>
    <AvailableItemName Include="MonorailCss" />
  </ItemGroup>

  <!-- Process each MonorailCss file -->
  <Target Name="ProcessMonorailCss"
          BeforeTargets="BeforeBuild"
          Condition="'$(MonorailCssEnabled)' == 'true' and '@(MonorailCss)' != ''"
          Inputs="@(MonorailCss);@(Content);@(Compile);@(EmbeddedResource)"
          Outputs="@(MonorailCss->'%(OutputFile)')">

    <!-- Set default output file for each MonorailCss item if not specified -->
    <ItemGroup>
      <MonorailCss>
        <OutputFile Condition="'%(OutputFile)' == ''">$(MSBuildProjectDirectory)\wwwroot\css\%(Filename).css</OutputFile>
      </MonorailCss>
    </ItemGroup>

    <!-- Execute the ProcessCssTask for each input file -->
    <!-- Use @source and @import directives in your CSS file to configure source scanning -->
    <!-- Pass MSBuild properties to enable placeholder resolution in @source paths -->
    <ProcessCssTask
      InputFile="%(MonorailCss.Identity)"
      OutputFile="%(MonorailCss.OutputFile)"
      Configuration="$(Configuration)"
      TargetFramework="$(TargetFramework)"
      RuntimeIdentifier="$(RuntimeIdentifier)" />

  </Target>

  <!-- Clean target to remove generated files -->
  <Target Name="CleanMonorailCss"
          BeforeTargets="Clean"
          Condition="'$(MonorailCssEnabled)' == 'true'">
    <Delete Files="@(MonorailCss->'%(OutputFile)')" />
  </Target>
</Project>