<Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    <PropertyGroup>
        <TargetFramework>net9.0</TargetFramework>
        <Nullable>enable</Nullable>
        <ImplicitUsings>enable</ImplicitUsings>
        <PublishTrimmed>true</PublishTrimmed>
        <LangVersion>preview</LangVersion>
        <BlazorEnableTimeZoneSupport>false</BlazorEnableTimeZoneSupport>
        <BlazorWebAssemblyPreserveCollationData>false</BlazorWebAssemblyPreserveCollationData>
        <!-- Enable development mode for MonorailCss -->
        <MonorailCssDevelopment>true</MonorailCssDevelopment>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="BadIdeas.Icons.FontAwesome" Version="0.0.0-alpha.0.21" />
        <PackageReference Include="BlazorMonaco" Version="3.3.0" />
        <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly" Version="9.0.9" />
        <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.DevServer" Version="9.0.9" PrivateAssets="all" />
    </ItemGroup>

    <ItemGroup>
      <ProjectReference Include="..\..\src\MonorailCss\MonorailCss.csproj" />
      <!-- Reference the MSBuild task project to ensure it builds first -->
      <ProjectReference Include="..\..\src\MonorailCss.Build.Tasks\MonorailCss.Build.Tasks.csproj"
                        ReferenceOutputAssembly="false"
                        PrivateAssets="All"
                        SetTargetFramework="TargetFramework=net9.0" />
    </ItemGroup>

    <!-- Import the MonorailCss targets conditionally after the build tasks are available -->
    <Import Project="..\..\src\MonorailCss.Build.Tasks\build\MonorailCss.Build.Tasks.targets"
            Condition="Exists('..\..\src\MonorailCss.Build.Tasks\bin\$(Configuration)\net9.0\MonorailCss.Build.Tasks.dll')" />

    <!-- Mark app.css file with MonorailCss build action -->
    <ItemGroup>
      <MonorailCss Include="app.css">
        <OutputFile>$(MSBuildProjectDirectory)\wwwroot\css\app.css</OutputFile>
      </MonorailCss>
    </ItemGroup>

    <!-- Ensure build tasks are built before processing CSS -->
    <Target Name="EnsureMonorailCssBuildTasks" BeforeTargets="ProcessMonorailCss">
      <MSBuild Projects="..\..\src\MonorailCss.Build.Tasks\MonorailCss.Build.Tasks.csproj"
               Targets="Build"
               Properties="Configuration=$(Configuration)"
               Condition="!Exists('..\..\src\MonorailCss.Build.Tasks\bin\$(Configuration)\net9.0\MonorailCss.Build.Tasks.dll')" />
    </Target>
</Project>